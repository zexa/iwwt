{% extends 'base.html.twig' %}

{% block stylesheets %}
<style>
    main {
        display: flex;
        flex-direction: column;
        justify-content: center;
        min-height: 90vh;
    }
</style>
{% endblock %}

{% block title %}Sign Up!{% endblock %}

{% block body %}
<main>
    <h1>Sign up</h1>

    {{ form_start(form) }}
        {{ form_errors(form) }} {# Display global form errors #}

        <div class="form-group">
            {{ form_widget(form.email, {
                'attr': {
                    'oninput': 'clearError(this)',
                    'placeholder': 'Email',
                    'autocomplete': 'email',
                    'autofocus': true,
                    'aria-describedby': 'email-helper',
                    'aria-invalid': form.email.vars.errors|length > 0 ? 'true' : null
                }
            }) }}
            {% if form.email.vars.errors|length > 0 %}
                <small id="email-helper" class="form-text text-danger">
                    {% for error in form.email.vars.errors %}
                        <small>{{ error.message }}</small><br>
                    {% endfor %}
                </small>
            {% endif %}
        </div>

        <div class="form-group">
            {{ form_widget(form.password, {
                'attr': {
                    'oninput': 'clearError(this)',
                    'placeholder': 'Password',
                    'autocomplete': 'current-password',
                    'aria-describedby': 'password-helper',
                    'aria-invalid': form.password.vars.errors|length > 0 ? 'true' : null
                }
            }) }}
            {% if form.password.vars.errors|length > 0 %}
                <small id="password-helper" class="form-text text-danger">
                    {% for error in form.password.vars.errors %}
                        <small>{{ error.message }}</small><br>
                    {% endfor %}
                </small>
            {% endif %}
        </div>

        <button type="submit">Sign up</button>
    {{ form_end(form) }}
    <a href="/login">Already have an account?</a>
</main>
{% endblock %}

{% block javascripts %}
<script>
    function clearError(input) {
        // Remove aria-invalid and helper text when user starts typing
        const helperId = input.getAttribute('aria-describedby');
        const helperText = document.getElementById(helperId);
        
        if (helperText) {
            helperText.innerHTML = '';  // Clear the inner HTML instead of removing
        }
        input.removeAttribute('aria-invalid');
    }
</script>
{% endblock %}
